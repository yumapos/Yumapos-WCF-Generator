//------------------------------------------------------------------------------
// <auto-generated>
//	 This code was generated from a template.
//
//	 Manual changes to this file may cause unexpected behavior in your application.
//	 Manual changes to this file will be overwritten if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using YumaPos.Shared.Terminal.Infrastructure;
using YumaPos.FrontEnd.Infrastructure.CommandProcessing;
namespace TestWcfClientGenerator
{
	public sealed class ApiLogOfCallsDecorator : TestWcfClientGenerator.IWcfServiceApi
	{
		private readonly TestWcfClientGenerator.IWcfServiceApi _actor;
		private readonly Action<string> _logger;
		private readonly Func<object, string> _serializer;
		private readonly Func<bool> _logEnabledProvider;
		#region Properties
		public ExecutionContext ExecutionContext
		{
			get { { return _actor.ExecutionContext; } }
			set { { _actor.ExecutionContext = value; } }
		}
		#endregion
		public ApiLogOfCallsDecorator(TestWcfClientGenerator.IWcfServiceApi actor, Func<bool> logEnabledProvider, Action<string> logger, Func<object, string> serializer)
		{
			if (actor == null) throw new ArgumentNullException(nameof(actor));
			if (logger == null) throw new ArgumentNullException(nameof(logger));
			if (serializer == null) throw new ArgumentNullException(nameof(serializer));
			if (logEnabledProvider == null) throw new ArgumentNullException(nameof(logEnabledProvider));
			_actor = actor;
			_logger = logger;
			_serializer = serializer;
			_logEnabledProvider = logEnabledProvider;
		}
		private void LogRequest(string method, object requestDto)
		{
			if (_logEnabledProvider())
			{
				_logger($"[API] [REQUEST] {method}\nExecutionContext: {_serializer(ExecutionContext)}\nRequest data: {_serializer(requestDto)}");
			}
		}
		private void LogResponse(string method, object responseDto)
		{
			if (_logEnabledProvider())
			{
				_logger($"[API] [RESPONSE] {method}\nExecutionContext: {_serializer(ExecutionContext)}\nResponse data: {_serializer(responseDto)}");
			}
		}
		public async System.Threading.Tasks.Task<TestDecoratorGeneration.ResponseDto> AddItem(System.Guid id, string name)
		{
			var parameters = new
			{
				id,
				name,
			};
			LogRequest("IWcfServiceApi.AddItem", parameters);
			var response = await _actor.AddItem(id, name);
			LogResponse("IWcfServiceApi.AddItem", response);
			if (!response.Context.IsEmpty() || response.PostprocessingType != null)
			{
				throw new ServerSecurityException(response.Context, response.PostprocessingType, response.Errors, response.ServerInfo) { Value = response.Value };
			}
			return response;
		}

		public async System.Threading.Tasks.Task<TestDecoratorGeneration.ItemDto> GetItems()
		{
			var parameters = new
			{
			};
			LogRequest("IWcfServiceApi.GetItems", parameters);
			var response = await _actor.GetItems();
			LogResponse("IWcfServiceApi.GetItems", response);
			if (!response.Context.IsEmpty() || response.PostprocessingType != null)
			{
				throw new ServerSecurityException(response.Context, response.PostprocessingType, response.Errors, response.ServerInfo) { Value = response.Value };
			}
			return response;
		}

	}
}
